(function(t){function e(e){for(var n,a,r=e[0],l=e[1],h=e[2],d=0,u=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&u.push(i[a][0]),i[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);c&&c(e);while(u.length)u.shift()();return o.push.apply(o,h||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],n=!0,r=1;r<s.length;r++){var l=s[r];0!==i[l]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=s[0]))}return t}var n={},i={app:0},o=[];function a(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=n,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var c=l;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0083":function(t,e,s){},3857:function(t,e,s){},"4c1b":function(t,e,s){"use strict";var n=s("0083"),i=s.n(n);i.a},"4e77":function(t,e,s){"use strict";var n=s("3857"),i=s.n(n);i.a},"56d7":function(t,e,s){"use strict";s.r(e);var n=s("2b0e"),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("TopPanel"),s("LeftPanel"),s("RightPanel"),s("MainCanvas")],1)},o=[],a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"v_left-panel absolute-y-center p-5 text-center"},[s("button",{staticClass:"btn btn-primary btn btn-primary btn-circle btn-xl",on:{click:t.newPath}},[t._v("new")]),s("button",{staticClass:"btn btn-primary btn btn-primary btn-circle btn-xl",on:{click:function(e){return t.store.selectTool("PEN")}}},[t._v("Pen")]),s("button",{staticClass:"btn btn-primary btn btn-primary btn-circle btn-xl",on:{click:function(e){return t.store.selectTool("SELECT")}}},[t._v("select")]),s("button",{staticClass:"btn btn-primary btn btn-primary btn-circle btn-xl",on:{click:function(e){return t.store.deleteSegment()}}},[t._v("delPoint")])])},r=[];function l(){return{id:Date.now(),definition:[],rotation:null,center:{},rotationCenter:{}}}function h(t){let e={};return e.x=Math.round(t.x),e.y=Math.round(t.y),e}window.SELECTED_PATH={};const c={debug:!0,state:{history:[],historyPos:-1,allPaths:[],selectedPathIndex:null,selectedPathId:null,tool:"PEN",transformMatrix:null,currentPoint:{},livePreviewSegment:{},selectedPointId:null,selectedPointStep:null,selectedPointIndex:null,movePoint:!1,svgPoint:{},isFirstPoint:!0,isDrawing:!1,currentSegment:"L",snapToGrid:!0,hideControls:!1},createPath(){this.debug&&console.log("createPath"),this.state.allPaths.push(l()),this.state.selectedPathIndex=this.state.allPaths.length-1,this.state.selectedPathId=this.state.allPaths[this.state.selectedPathIndex].id,this.state.isFirstPoint=!0,this.debug&&console.log("index:",this.state.selectedPathIndex),this.debug&&console.log("id:",this.state.selectedPathId)},selectTool(t){this.debug&&console.log("selectTool",t),this.state.tool=t,"PEN"===t&&null===this.state.selectedPathIndex&&this.createPath()},handleMouseDown(t,e){this.debug&&console.log("handleMouseDown"),this.state.transformMatrix=e.getScreenCTM().inverse(),this.state.svgPoint=document.querySelector("#app svg").createSVGPoint();const{selectedPointIndex:s,selectedPathIndex:n}=this.state;let i;switch(null!==n&&(i=this.state.allPaths[n].definition.length),this.state.tool){case"PEN":this.state.isDrawing=!0,i-1===s?(this.debug&&console.log("end"),this.addSegment(t,"END")):0===s?(this.debug&&console.log("start"),this.addSegment(t,"START")):(this.debug&&console.log("new"),this.createPath(),this.addSegment(t,"NEW"));break;default:return}},handleMouseMove(t){if(this.debug&&console.log("handleMouseMove"),"PEN"===this.state.tool&&!this.state.movePoint){if(0===this.state.allPaths[this.state.selectedPathIndex].definition.length)return;let e=this.state.svgPoint;e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(this.state.transformMatrix),this.state.snapToGrid&&(e=h(e)),this.state.livePreviewSegment={type:"L",dest:{x:e.x,y:e.y}}}if("PEN"===this.state.tool&&this.state.isDrawing){let{allPaths:e,selectedPathIndex:s,selectedPointIndex:n,snapToGrid:i}=this.state,o=e[s].definition[n-1].dest,a=this.state.svgPoint;a.x=t.clientX,a.y=t.clientY,a=a.matrixTransform(this.state.transformMatrix),i&&(a=h(a)),e[s].definition[n].type="C",e[s].definition[n].curve1={x:o.x,y:o.y},e[s].definition[n].curve2={x:a.x,y:a.y}}if(this.state.movePoint){let e=this.state.svgPoint;e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(this.state.transformMatrix),this.state.snapToGrid&&(e=h(e)),this.state.allPaths[this.state.selectedPathIndex].definition[this.state.selectedPointIndex][this.state.selectedPointStep]={x:e.x,y:e.y}}},handleMouseUp(){let{allPaths:t,selectedPathIndex:e,selectedPointIndex:s}=this.state;this.state.movePoint&&this.historySnapshot(),this.state.movePoint=!1,this.state.isDrawing=!1,null!==e&&null!==s&&(this.state.currentPoint=t[e].definition[s].dest)},addSegment(t,e){this.debug&&console.log("addSegment",t);let{allPaths:s,selectedPathIndex:n,selectedPointIndex:i}=this.state,o=document.querySelector("#app svg").createSVGPoint();if(o.x=t.clientX,o.y=t.clientY,o=o.matrixTransform(this.state.transformMatrix),this.state.snapToGrid&&(o=h(o)),this.state.currentPoint={x:o.x,y:o.y},"END"===e){let t=Date.now();s[n].definition.push({type:"L",id:t,curve1:{},curve2:{},dest:{x:o.x,y:o.y}}),this.state.selectedPointId=t,this.state.selectedPointIndex++}if("START"===e){let t=Date.now();s[n].definition.unshift({type:"M",id:t,curve1:{},curve2:{},dest:{x:o.x,y:o.y}}),s[n].definition[i+1].type="L",this.state.selectedPointId=t,this.state.isDrawing=!1}if("NEW"===e){let t=Date.now();this.state.allPaths[this.state.selectedPathIndex].definition.push({type:"M",id:t,curve1:{},curve2:{},dest:{x:o.x,y:o.y}}),this.state.isDrawing=!1,this.state.selectedPointId=t,this.state.selectedPointIndex=0}this.state.isFirstPoint=!1,this.historySnapshot()},deleteSegment(){this.debug&&console.log("deleteSegment");let{selectedPointIndex:t,selectedPathIndex:e}=this.state;null!==t&&(0===t&&this.state.allPaths[e].length>1&&(this.state.allPaths[e].definition[1].type="M"),this.state.allPaths[e].definition.splice(this.state.selectedPointIndex,1),this.state.selectedPointIndex=null,this.state.selectedPointId=null)},selectPath(t,e){this.debug&&console.log("selectPath",t,e),"SELECT"===this.state.tool&&(this.state.selectedPathId=t,this.state.selectedPathIndex=e)},setSelectedPoint(t,e){let{allPaths:s,selectedPathIndex:n}=this.state;this.state.movePoint=!0,this.state.selectedPointId=t,this.state.selectedPointStep=e,this.state.selectedPointIndex=s[n].definition.findIndex(e=>e.id===t),this.state.svgPoint=document.querySelector("#app svg").createSVGPoint(),this.state.currentPoint=s[n].definition[this.state.selectedPointIndex].dest},updatePathCenter(t){let e={x:t.x+t.width/2,y:t.y+t.height/2};this.state.allPaths[this.state.selectedPathIndex].center=e},updateRotation(t){this.state.allPaths[c.state.selectedPathIndex].rotation=t,this.updateRotationCenter(),this.state.transformMatrix=window.SELECTED_PATH.getScreenCTM().inverse()},updateRotationCenter(){let t=this.state.allPaths[this.state.selectedPathIndex].center;this.state.allPaths[this.state.selectedPathIndex].rotationCenter=t},historySnapshot(){this.debug&&console.log("historySnapshot"),this.state.historyPos>-1&&(this.state.history.splice(0,this.state.historyPos+1),console.log("snapshot clear",this.state.history),this.state.historyPos=-1);const t=JSON.parse(JSON.stringify(this.state.allPaths));this.state.history.unshift(t)},setHistoryPos(t){this.debug&&console.log("setHistoryPos",t),this.state.historyPos+=t},historyGoTo(t=0){this.debug&&console.log("historyGoTo",t),n["a"].set(this.state,"allPaths",JSON.parse(JSON.stringify(this.state.history[t+1]))),this.selectTool(this.state.tool),this.state.selectedPathIndex=null,this.state.selectedPathId=null,this.state.currentPoint={},this.state.livePreviewSegment={},this.state.selectedPointId=null,this.state.selectedPointStep=null,this.state.selectedPointIndex=null,this.state.isFirstPoint=!0}};var d=c,u={name:"LeftPanel",data:function(){return{store:d}},methods:{newPath:function(){this.store.createPath(),this.store.selectTool("PEN")}}},P=u,f=(s("4e77"),s("2877")),p=Object(f["a"])(P,a,r,!1,null,"771cddbc",null),v=p.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._v("tbd right panel "),null!=t.store.state.selectedPathIndex?s("div",[t._v(" rotation "),s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.rotate,expression:"rotate",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:t.rotate},on:{input:function(e){e.target.composing||(t.rotate=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" snap to grid "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.store.state.snapToGrid,expression:"store.state.snapToGrid"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.store.state.snapToGrid)?t._i(t.store.state.snapToGrid,null)>-1:t.store.state.snapToGrid},on:{change:function(e){var s=t.store.state.snapToGrid,n=e.target,i=!!n.checked;if(Array.isArray(s)){var o=null,a=t._i(s,o);n.checked?a<0&&t.$set(t.store.state,"snapToGrid",s.concat([o])):a>-1&&t.$set(t.store.state,"snapToGrid",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.store.state,"snapToGrid",i)}}}),t._v(" hide controls "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.store.state.hideControls,expression:"store.state.hideControls"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.store.state.hideControls)?t._i(t.store.state.hideControls,null)>-1:t.store.state.hideControls},on:{change:function(e){var s=t.store.state.hideControls,n=e.target,i=!!n.checked;if(Array.isArray(s)){var o=null,a=t._i(s,o);n.checked?a<0&&t.$set(t.store.state,"hideControls",s.concat([o])):a>-1&&t.$set(t.store.state,"hideControls",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.store.state,"hideControls",i)}}})]):t._e()])},x=[],m={name:"RightPanel",data:function(){return{store:d}},computed:{rotate:{get(){return this.store.state.allPaths[d.state.selectedPathIndex].rotation},set(t){this.store.updateRotation(t)}}}},g=m,b=Object(f["a"])(g,y,x,!1,null,"34a3b392",null),w=b.exports,I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._v("tbd top panel "),s("button",{on:{click:t.historyUndo}},[t._v("undo")]),s("button",{on:{click:t.historyRedo}},[t._v("redo")])])},S=[],T={name:"TopPanel",data:function(){return{store:d}},methods:{historyUndo(){this.store.state.historyPos!==this.store.state.history.length-1&&(this.store.setHistoryPos(1),this.store.historyGoTo(this.store.state.historyPos))},historyRedo(){-1!==this.store.state.historyPos&&(this.store.setHistoryPos(-1),this.store.historyGoTo(this.store.state.historyPos))}}},_=T,C=Object(f["a"])(_,I,S,!1,null,"cd3bfacc",null),M=C.exports,E=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{on:{mouseup:t.endPointMove}},[s("svg",{staticClass:"v_app-canvas absolute-center shadow",attrs:{stroke:"black",viewBox:"0 0 24 24"},on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove}},[t._l(t.store.state.allPaths,(function(t,e){return s("SvgPath",{key:t.id,ref:t.id,refInFor:!0,attrs:{definition:t.definition,path:t,id:t.id,index:e}})})),t._l(t.store.state.allPaths,(function(e,n){return s("g",{key:"g-"+e.id,class:{active:e.id===t.store.state.selectedPathId},attrs:{transform:t.transform(e)}},t._l(e.definition,(function(i,o){return s("g",{key:"s-"+i.id,class:{hide:t.store.state.hideControls},attrs:{stroke:"none",fill:"blue"}},["C"===i.type?s("path",{attrs:{d:"M"+e.definition[o-1].dest.x+" "+e.definition[o-1].dest.y+" L "+i.curve1.x+" "+i.curve1.y,stroke:"blue","stroke-width":"0.5"}}):t._e(),"C"===i.type?s("circle",{attrs:{cx:i.curve1.x,cy:i.curve1.y,r:".5"},on:{mousedown:function(e){return t.startPointMove(i.id,"curve1")},click:function(s){return t.selectPath(e.id,n)}}}):t._e(),"C"===i.type?s("path",{attrs:{d:"M"+i.dest.x+" "+i.dest.y+" L "+i.curve2.x+" "+i.curve2.y,stroke:"blue","stroke-width":"0.5"}}):t._e(),"C"===i.type?s("circle",{attrs:{cx:i.curve2.x,cy:i.curve2.y,r:".5"},on:{mousedown:function(e){return t.startPointMove(i.id,"curve2")},click:function(s){return t.selectPath(e.id,n)}}}):t._e(),s("circle",{attrs:{cx:i.dest.x,cy:i.dest.y,r:"1"},on:{mousedown:function(e){return t.startPointMove(i.id,"dest")},mouseup:t.drawLine,click:function(s){return t.selectPath(e.id,n)}}})])})),0)})),t.hasLivePreview?s("path",{class:{hide:t.store.state.hideControls},attrs:{id:"live-preview-path",d:t.livePreview,stroke:"blue",transform:t.transform(t.store.state.allPaths[t.store.state.selectedPathIndex])}}):t._e()],2)])},k=[],$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("path",{ref:"path",class:{active:t.isActive},attrs:{d:t.dToString,fill:"none",transform:t.transform},on:{click:t.handleClick}})},D=[],L={name:"SvgPath",props:{definition:Array,id:Number,index:Number,path:Object},data:function(){return{store:d}},computed:{dToString:function(){let t="";return this.definition.forEach(e=>{t+=[e.type,e.curve1.x,e.curve1.y,e.curve2.x,e.curve2.y,e.dest.x,e.dest.y].join(" ")}),t},isActive:function(){return this.store.state.selectedPathId===this.id},transform:function(){let t="";return this.path.rotation&&(t+=`rotate(${this.path.rotation} ${this.path.rotationCenter.x} ${this.path.rotationCenter.y})`),t}},methods:{handleClick:function(){this.store.selectPath(this.id,this.index)}},beforeUpdate:function(){this.isActive&&this.store.updatePathCenter(this.$refs.path.getBBox())},updated:function(){let{selectedPathId:t}=this.store.state;this.id===t&&window.SELECTED_PATH!==this.$refs.path&&(window.SELECTED_PATH=this.$refs.path)},created:function(){let{selectedPathId:t}=this.store.state;this.id===t&&window.SELECTED_PATH!==this.$refs.path&&(window.SELECTED_PATH=this.$refs.path)}},N=L,O=(s("a816"),Object(f["a"])(N,$,D,!1,null,"64588782",null)),A=O.exports,G={name:"MainCanvas",data:function(){return{store:d}},components:{SvgPath:A},computed:{hasLivePreview:function(){return!d.state.isFirstPoint&&"PEN"===d.state.tool},livePreview:function(){const{currentPoint:t,livePreviewSegment:e}=this.store.state;let s="";return e.dest&&(s=["M",t.x,t.y,e.type,e.dest.x,e.dest.y].join(" ")),s}},methods:{drawLine(){let{tool:t}=this.store.state;"PEN"===t&&(this.store.state.currentSegment="L",this.store.state.isDrawing=!1)},handleMouseDown:function(t){let e=this.store.state.selectedPathId;e&&this.store.handleMouseDown(t,this.$refs[e][0].$el)},handleMouseMove:function(t){let e=this.store.state.selectedPathId;e&&this.store.handleMouseMove(t,this.$refs[e][0].$el)},selectPath:function(t,e){this.store.selectPath(t,e)},transform:function(t){let e="";return t&&t.rotation&&(e+=`rotate(${t.rotation} ${t.rotationCenter.x} ${t.rotationCenter.y})`),e},startPointMove:function(t,e){this.store.setSelectedPoint(t,e)},endPointMove:function(){this.store.handleMouseUp()}}},j=G,R=(s("4c1b"),Object(f["a"])(j,E,k,!1,null,"681c27b6",null)),H=R.exports,F={name:"App",data:function(){return{store:d}},created:function(){this.store.createPath()},components:{LeftPanel:v,RightPanel:w,TopPanel:M,MainCanvas:H}},J=F,U=Object(f["a"])(J,i,o,!1,null,null,null),X=U.exports;n["a"].config.productionTip=!0,new n["a"]({data:d,render:t=>t(X)}).$mount("#app")},"9e77":function(t,e,s){},a816:function(t,e,s){"use strict";var n=s("9e77"),i=s.n(n);i.a}});
//# sourceMappingURL=app.27a7516a.js.map